const fs = require('fs');

function readJson(filePath) {
  let text = fs.readFileSync(filePath, 'utf8');
  if (text.charCodeAt(0) === 0xfeff) text = text.slice(1);
  return JSON.parse(text);
}

function writeJson(filePath, data) {
  fs.writeFileSync(filePath, `${JSON.stringify(data, null, 2)}\n`, 'utf8');
}

function patchComment(sessionName, sectionTitle, problemNumber, newComment) {
  const filePath = `datasets/problem2022/${sessionName}/comment1.json`;
  const data = readJson(filePath);
  for (const section of data) {
    if (section.title !== sectionTitle) continue;
    const target = section.comments.find((c) => c.problem_number === problemNumber);
    if (!target) throw new Error(`comment not found: ${sessionName} ${sectionTitle} #${problemNumber}`);
    target.comment = newComment;
    writeJson(filePath, data);
    return;
  }
  throw new Error(`section not found: ${sessionName} ${sectionTitle}`);
}

function main() {
  patchComment(
    'first',
    '정보시스템 기반 기술',
    10,
    [
      'FCFS는 도착 순서대로 CPU를 할당하므로 실행 순서는 A → B → C → D 입니다.',
      'Turn Around Time(반환시간)은 `완료시간 - 도착시간`으로 계산합니다.',
      '',
      '풀이 순서:',
      '- A: 0~6 실행 → 완료시간 6 → 반환시간 6-0 = 6',
      '- B: 6~9 실행 → 완료시간 9 → 반환시간 9-1 = 8',
      '- C: 9~10 실행 → 완료시간 10 → 반환시간 10-2 = 8',
      '- D: 10~18 실행 → 완료시간 18 → 반환시간 18-3 = 15',
      '- 평균 반환시간 = (6 + 8 + 8 + 15) / 4 = 37 / 4 = 9.25',
      '',
      '핵심 정리:',
      '- 정답 선택지: 1번 (9.25)',
      '- FCFS는 도착 순서가 곧 실행 순서이므로 표에서 도착시간 기준으로 먼저 줄을 세우는 것이 핵심입니다.',
    ].join('\n')
  );

  patchComment(
    'first',
    '정보시스템 기반 기술',
    14,
    [
      'FCFS 디스크 스케줄링은 요청이 들어온 순서대로 헤드를 이동시킵니다.',
      '현재 헤드 위치가 50이고 대기 큐가 10 → 40 → 55 → 35 이므로 이동 거리를 순서대로 더하면 됩니다.',
      '',
      '풀이 순서:',
      '- 50 → 10 : 40',
      '- 10 → 40 : 30',
      '- 40 → 55 : 15',
      '- 55 → 35 : 20',
      '- 총 이동 거리 = 40 + 30 + 15 + 20 = 105',
      '',
      '핵심 정리:',
      '- 정답 선택지: 3번 (105)',
      '- FCFS 디스크 문제는 각 구간의 절대값 거리(`|다음트랙 - 현재트랙|`)를 누적하면 됩니다.',
    ].join('\n')
  );

  patchComment(
    'second',
    '정보시스템 기반 기술',
    10,
    [
      '비선점 SJF는 CPU가 비는 시점마다 “도착해 있는 작업 중 실행시간이 가장 짧은 작업”을 선택합니다.',
      '표 기준으로 작업 1(0,23), 작업 2(3,35), 작업 3(8,10) 입니다.',
      '',
      '실행 순서 판단:',
      '- 시간 0에는 작업 1만 도착 → 작업 1 실행 (0~23)',
      '- 시간 23에는 작업 2, 3이 모두 도착해 있음 → 실행시간이 짧은 작업 3 먼저 실행 (23~33)',
      '- 마지막으로 작업 2 실행 (33~68)',
      '',
      '대기시간 계산:',
      '- 작업 1: 시작 0 - 도착 0 = 0',
      '- 작업 3: 시작 23 - 도착 8 = 15',
      '- 작업 2: 시작 33 - 도착 3 = 30',
      '- 평균 대기시간 = (0 + 15 + 30) / 3 = 15',
      '',
      '핵심 정리:',
      '- 정답 선택지: 1번 (15)',
      '- SJF 문제는 먼저 실행 순서를 확정하고, 이후 `시작시간 - 도착시간`으로 대기시간을 계산하면 됩니다.',
    ].join('\n')
  );

  patchComment(
    'second',
    '데이터베이스의 활용',
    45,
    [
      '문제는 “3학년”이면서 “컴퓨터공학과”인 학생의 이름만 조회하라고 했으므로 조건이 2개 모두 만족되어야 합니다.',
      '따라서 `WHERE` 절에서 `AND`를 사용해야 하며, 조회 컬럼은 `이름`만 선택해야 합니다.',
      '',
      '확인 포인트:',
      '- 조회 대상 컬럼: `이름`',
      '- 조건 1: `학년 = 3`',
      '- 조건 2: `학과 = \"컴퓨터공학\"`',
      '- 두 조건 동시 만족: `AND`',
      '',
      '핵심 정리:',
      '- 정답 선택지: 1번 (SELECT 이름 FROM 학생 WHERE 학년 = 3 AND 학과 = “컴퓨터공학”;)',
      '- `OR`를 쓰면 조건 하나만 만족해도 포함되므로 문제 조건과 달라집니다.',
    ].join('\n')
  );

  patchComment(
    'second',
    '데이터베이스의 활용',
    60,
    [
      '이 문제는 하위 질의(Subquery) 결과를 먼저 구한 뒤, 그 값을 바깥 질의 조건에 대입하면 됩니다.',
      '',
      '풀이 순서:',
      '- 하위 질의: `SELECT 책번호 FROM 도서 WHERE 책명 = ‘운영체제’`',
      '- 도서 테이블에서 ‘운영체제’의 책번호는 `1111`',
      '- 바깥 질의: `SELECT 가격 FROM 도서가격 WHERE 책번호 = 1111`',
      '- 도서가격 테이블에서 책번호 1111의 가격은 `15000`',
      '',
      '핵심 정리:',
      '- 정답 선택지: 3번 (15000)',
      '- 하위 질의가 단일값(책번호 1111)을 반환하므로 `=` 비교가 성립합니다.',
    ].join('\n')
  );

  patchComment(
    'third',
    '정보시스템 기반 기술',
    6,
    [
      'RR(Round Robin)은 시간 할당량(Time Quantum)만큼씩 번갈아 CPU를 주는 선점형 스케줄링입니다.',
      '시간 할당량이 매우 커지면 한 번 CPU를 잡은 프로세스가 거의 끝날 때까지 실행되므로 선점 효과가 사실상 사라집니다.',
      '',
      '따라서 실행 순서는 도착 순서대로 한 번씩 처리하는 FCFS(FIFO)와 같은 형태에 가까워집니다.',
      '',
      '핵심 정리:',
      '- 정답 선택지: 2번 (FCFS(FIFO))',
      '- RR에서 시간 할당량이 작을수록 RR의 특징이 강해지고, 클수록 FCFS에 가까워집니다.',
    ].join('\n')
  );

  patchComment(
    'third',
    '정보시스템 기반 기술',
    13,
    [
      'FCFS 디스크 스케줄링이므로 요청 대기열 순서(100, 180, 40, 120, 0, 130, 70, 80, 150, 200)를 그대로 따라갑니다.',
      '현재 헤드 위치는 50이므로 각 이동 구간의 절대값을 모두 더하면 총 이동 거리가 됩니다.',
      '',
      '구간별 이동 거리:',
      '- 50→100 = 50',
      '- 100→180 = 80',
      '- 180→40 = 140',
      '- 40→120 = 80',
      '- 120→0 = 120',
      '- 0→130 = 130',
      '- 130→70 = 60',
      '- 70→80 = 10',
      '- 80→150 = 70',
      '- 150→200 = 50',
      '- 총합 = 790',
      '',
      '핵심 정리:',
      '- 정답 선택지: 1번 (790)',
      '- FCFS 디스크 문제는 “순서 유지 + 절대값 거리 누적” 두 가지만 지키면 계산할 수 있습니다.',
    ].join('\n')
  );

  patchComment(
    'third',
    '데이터베이스의 활용',
    53,
    [
      '각 SQL문이 “중복 제거 여부”와 “조건 적용 결과”를 어떻게 만드는지 순서대로 보면 됩니다.',
      '',
      '주어진 데이터:',
      '- 컴퓨터정보과 120명',
      '- 인터넷정보과 160명',
      '- 사무자동화과 80명',
      '- 총 학생 수 = 120 + 160 + 80 = 360명',
      '',
      'SQL별 결과:',
      '- ㉠ `SELECT DISTINCT DEPT FROM STUDENT;`',
      '  → 학과명을 중복 제거해서 조회하므로 학과 종류 수 = 3',
      '- ㉡ `SELECT DEPT FROM STUDENT;`',
      '  → 중복 제거 없이 모든 학생의 학과를 조회하므로 튜플 수 = 전체 학생 수 = 360',
      '- ㉢ `SELECT COUNT(DISTINCT DEPT) FROM STUDENT WHERE DEPT = ‘컴퓨터정보과’;`',
      '  → WHERE 절로 컴퓨터정보과만 남기면 DEPT 값은 하나뿐이고, DISTINCT 후 COUNT 결과는 1',
      '',
      '핵심 정리:',
      '- 정답 선택지: 1번 (㉠ 3, ㉡ 360, ㉢ 1)',
      '- `DISTINCT`는 값의 종류 수를 줄이고, `COUNT(DISTINCT 컬럼)`은 “중복 제거 후 개수”를 센다는 점이 핵심입니다.',
    ].join('\n')
  );

  patchComment(
    'third',
    '데이터베이스의 활용',
    56,
    [
      '`LIKE`에서 `_`(언더스코어)는 “임의의 한 글자”를 의미합니다.',
      `따라서 \`LIKE '박__'\` 는 “박으로 시작하는 정확히 3글자 이름”을 뜻합니다.`,
      '',
      `문제의 조건은 \`NOT LIKE '박__'\` 이므로, 위 조건에 해당하는 이름을 제외한다는 의미입니다.`,
      '',
      '정리하면:',
      '- 제외 대상: 박으로 시작하는 3글자 이름',
      '- 조회 대상: 박으로 시작하지 않는 3글자 이름 (보기 표현 기준)',
      '',
      '핵심 정리:',
      '- 정답 선택지: 4번 (‘박’으로 시작하지 않는 3글자의 문자 이름을 검색한다.)',
      '- `_`는 글자 수(한 글자), `%`는 글자 수 제한 없는 문자열이라는 차이를 구분해야 합니다.',
    ].join('\n')
  );

  console.log('patched 2022 manual detailed comments');
}

main();
